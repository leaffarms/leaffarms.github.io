const PRODUCE_IMAGES = {
	"banana_flower": {
		name: "Banana Flower",
		source: "images/produce/banana_flower.jpg",
		thumbnail: "images/produce/banana_flower_thumb.jpg",
		category: "",
	},
	"chapoo_(e-lert)": {
		name: "Chapoo (E-lert)",
		source: "images/produce/chapoo.jpg",
		thumbnail: "images/produce/chapoo_thumb.jpg",
		category: "",
	},
	"chayote": {
		name: "Chayote",
		source: "images/produce/chayote.jpg",
		thumbnail: "images/produce/chayote_thumb.jpg",
		category: "",
	},
	"chinese_bitter_melon": {
		name: "Chinese Bitter Melon",
		source: "images/produce/chinese_bitter_melon.jpg",
		thumbnail: "images/produce/chinese_bitter_melon_thumb.jpg",
		category: "",
	},
	"chinese_celery": {
		name: "Chinese Celery",
		source: "images/produce/chinese_celery.jpg",
		thumbnail: "images/produce/chinese_celery_thumb.jpg",
		category: "",
	},
	"chinese_lo_bok": {
		name: "Chinese Lo Bok",
		source: "images/produce/chinese_lo_bok.jpg",
		thumbnail: "images/produce/chinese_lo_bok_thumb.jpg",
		category: "",
	},
	"chive_flower": {
		name: "Chive Flower",
		source: "images/produce/chive_flower.jpg",
		thumbnail: "images/produce/chive_flower_thumb.jpg",
		category: "",
	},
	"culantro": {
		name: "Culantro",
		source: "images/produce/culantro.jpg",
		thumbnail: "images/produce/culantro_thumb.jpg",
		category: "",
	},
	"flat_valor": {
		name: "Flat Valor",
		source: "images/produce/flat_valor.jpg",
		thumbnail: "images/produce/flat_valor_thumb.jpg",
		category: "",
	},
	"fuzzy_squash": {
		name: "Fuzzy Squash",
		source: "images/produce/fuzzy_squash.jpg",
		thumbnail: "images/produce/fuzzy_squash_thumb.jpg",
		category: "",
	},
	"gai_lan": {
		name: "Gai Lan",
		source: "images/produce/gai_lan.jpg",
		thumbnail: "images/produce/gai_lan_thumb.jpg",
		category: "",
	},
	"garlic": {
		name: "Garlic",
		source: "images/produce/garlic.jpg",
		thumbnail: "images/produce/garlic_thumb.jpg",
		category: "",
	},
	"ginger": {
		name: "Ginger",
		source: "images/produce/ginger.jpg",
		thumbnail: "images/produce/ginger_thumb.jpg",
		category: "",
	},
	"green_mango": {
		name: "Green Mango",
		source: "images/produce/green_mango.jpg",
		thumbnail: "images/produce/green_mango_thumb.jpg",
		category: "",
	},
	"green_papaya": {
		name: "Green Papaya",
		source: "images/produce/green_papaya.jpg",
		thumbnail: "images/produce/green_papaya_thumb.jpg",
		category: "",
	},
	"indian_bitter_melon": {
		name: "Indian Bitter Melon",
		source: "images/produce/indian_bitter_melon.jpg",
		thumbnail: "images/produce/indian_bitter_melon_thumb.jpg",
		category: "",
	},
	"indian_eggplant": {
		name: "Indian Eggplant",
		source: "images/produce/indian_eggplant.jpg",
		thumbnail: "images/produce/indian_eggplant_thumb.jpg",
		category: "",
	},
	"japanese_yam": {
		name: "Japanese Yam",
		source: "images/produce/japanese_yam.jpg",
		thumbnail: "images/produce/japanese_yam_thumb.jpg",
		category: "",
	},
	"kapocha": {
		name: "Kapocha",
		source: "images/produce/kapocha.jpg",
		thumbnail: "images/produce/kapocha_thumb.jpg",
		category: "",
	},
	"logan": {
		name: "Logan",
		source: "images/produce/logan.jpg",
		thumbnail: "images/produce/logan_thumb.jpg",
		category: "",
	},
	"long_bean": {
		name: "Long Bean",
		source: "images/produce/long_bean.jpg",
		thumbnail: "images/produce/long_bean_thumb.jpg",
		category: "",
	},
	"long_squash": {
		name: "Long Squash",
		source: "images/produce/long_squash.jpg",
		thumbnail: "images/produce/long_squash_thumb.jpg",
		category: "",
	},
	"mango": {
		name: "Mango",
		source: "images/produce/mango.jpg",
		thumbnail: "images/produce/mango_thumb.jpg",
		category: "",
	},
	"napa": {
		name: "Napa",
		source: "images/produce/napa.jpg",
		thumbnail: "images/produce/napa_thumb.jpg",
		category: "",
	},
	"passion_fruit": {
		name: "Passion Fruit",
		source: "images/produce/passion_fruit.jpg",
		thumbnail: "images/produce/passion_fruit_thumb.jpg",
		category: "",
	},
	"shanghai_bok_choy": {
		name: "Shanghai Bok Choy",
		source: "images/produce/shanghai_bok_choy.jpg",
		thumbnail: "images/produce/shanghai_bok_choy_thumb.jpg",
		category: "",
	},
	"thai_basil": {
		name: "Thai Basil",
		source: "images/produce/thai_basil.jpg",
		thumbnail: "images/produce/thai_basil_thumb.jpg",
		category: "",
	},
	"thai_eggplant": {
		name: "Thai Eggplant",
		source: "images/produce/thai_eggplant.jpg",
		thumbnail: "images/produce/thai_eggplant_thumb.jpg",
		category: "",
	},
	"thai_green_hot_pepper": {
		name: "Thai Green Hot Pepper",
		source: "images/produce/thai_green_hot_pepper.jpg",
		thumbnail: "images/produce/thai_green_hot_pepper_thumb.jpg",
		category: "",
	},
	"thai_red_hot_pepper": {
		name: "Thai Red Hot Pepper",
		source: "images/produce/thai_red_hot_pepper.jpg",
		thumbnail: "images/produce/thai_red_hot_pepper_thumb.jpg",
		category: "",
	},
	"tong_hao": {
		name: "Tong Hao",
		source: "images/produce/tong_hao.jpg",
		thumbnail: "images/produce/tong_hao_thumb.jpg",
		category: "",
	},
	"wawa": {
		name: "Wawa",
		source: "images/produce/wawa.jpg",
		thumbnail: "images/produce/wawa_thumb.jpg",
		category: "",
	},
	"wax_apple": {
		name: "Wax Apple",
		source: "images/produce/wax_apple.jpg",
		thumbnail: "images/produce/wax_apple_thumb.jpg",
		category: "",
	},
};

function loadGallery(imageList, showMax) {
	let output = "";
	let total = Object.keys(imageList).length;
	let count = 1;
	let showCount = 0;

	for (let key in imageList) {
		let value = imageList[key];
		let name = value["name"],
			source = value["source"],
			thumbnail = value["thumbnail"],
			category = value["category"];
		
		if (showCount < showMax) {
			output += "<div class=\"item\"><img id=\"" + count + " / " + total + "\" data-key=\"" + key  + "\" alt=\"" + name + "\" src=\"" + thumbnail + "\"><div class=\"item_details\">" + name + "</div></div>";
			showCount += 1;
		} else {
			output += "<div class=\"item hidden\"><img id=\"" + count + " / " + total + "\" data-key=\"" + key  + "\" alt=\"" + name + "\" src=\"" + thumbnail + "\"><div class=\"item_details\">" + name + "</div></div>";
		}

		count += 1;
	}
	document.getElementById("produce-gallery").innerHTML = output;
}

function showMoreImages(imageList, showNumber) {
	var list = document.getElementsByClassName("item hidden");
	var showNumber = Math.min(showNumber, list.length);

	for (let i = 0; i < showNumber; i++) {
		list[0].classList.remove("hidden");
	}

	if (list.length == 0) {
		document.getElementById("more-produce-button").style.display = "none";
		document.getElementById("fewer-produce-button").style.display = "inline-block";
	}
}

function getImageInfo(count, total) {
	let imgID = count + " / " + total;
	let key = document.getElementById(imgID).getAttribute("data-key");
	let value = PRODUCE_IMAGES[key];

	let info = {
		id: imgID,
		key: key,
		name: value["name"],
		source: value["source"],
		thumbnail: value["thumbnail"],
		category: value["category"]
	};

	return info;
}

function previousImage() {
	let img = document.getElementsByClassName("modal-img")[0];
	let count = document.getElementsByClassName("modal-count")[0];
	let caption = document.getElementsByClassName("modal-footer")[0]
	let [current, total] = count.innerHTML.split(" / ");
	let previous = current - 1;

	if (current == 1) {
		previous = total;
	}

	let prevCount = previous + " / " + total;
	let prevImg = getImageInfo(previous, total);

	img.src = prevImg.source;
	count.innerHTML = prevCount;
	caption.innerHTML = prevImg.name;
	img.onload = function() {
		updateImageSize();
	}
}

function nextImage() {
	let output = document.getElementsByClassName("modal-body")[0];
	let img = document.getElementsByClassName("modal-img")[0];
	let count = document.getElementsByClassName("modal-count")[0];
	let caption = document.getElementsByClassName("modal-footer")[0];
	let [current, total] = count.innerHTML.split(" / ");
	let next = parseInt(current) + 1;

	if (current == total) {
		next = 1;
	}

	let nextCount = next + " / " + total;
	let nextImg = getImageInfo(next, total);

	let newImg = new Image();
	newImg.src = nextImg.source;
	newImg.className = "modal-img";
	newImg.setAttribute("data-key", nextImg.key);

	// output.innerHTML = "";
	output.replaceChild(newImg, img);

	// img.src = nextImg.source;
	count.innerHTML = nextCount;
	caption.innerHTML = nextImg.name;
	newImg.onload = function() {
		updateImageSize();
	}
}

function updateImageSize() {
	let imageContainer = document.getElementsByClassName("modal-body")[0];
	let image = document.getElementsByClassName("modal-img")[0];

	let windowW = window.innerWidth*0.9;
	let windowH = window.innerHeight*0.9;

	let imageR = image.naturalWidth/image.naturalHeight;
	let windowR = windowW/windowH;

	if (windowR >= imageR) {
		image.height = windowH;
		image.width = windowH*imageR;
	} else {
		image.width = windowW;
		image.height = windowW/imageR;
	}
}

function closeModal() {
	document.getElementById("photo_modal").style.display = "none";
}

$(document).ready(function() {
	var modal = document.getElementById("photo_modal");

	$(".item").click(function(){
		let count = this.children[0].id;
		let [current, total] = count.split(" / ");
		let img = getImageInfo(current, total);

		let newImg = new Image();
		newImg.src = img.source;
		newImg.className = "modal-img"; 
		newImg.setAttribute("data-key", img.key);

		document.getElementsByClassName("modal-body")[0].innerHTML = "";
		document.getElementsByClassName("modal-body")[0].appendChild(newImg);

		$(".modal-count").html(img.id);
		$(".modal-footer").html(img.name);
		modal.style.display = "block";
		newImg.onload = function() {
			updateImageSize();
		}
	});

	$(".item").mouseover(function(){
		let name = this.children[1];
		name.style.opacity = "1";
	});

	$(".item").mouseout(function(){
		let name = this.children[1];
		name.style.opacity = "0";
	});

	$(".modal-body").click(function(){
		closeModal();
	});

	$(window).resize(function() {
		if ($(".modal").is(":visible")) {
			updateImageSize();
		}
	});
});
